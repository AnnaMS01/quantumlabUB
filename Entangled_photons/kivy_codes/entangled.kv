
#:import math math
#:import Factory kivy.factory.Factory
#:kivy 1.10.0

<TrueScreen>:
    orientation: 'vertical'

<TablePopup>:
    title: 'Table 1'
    FloatLayout:
        Button:
            size_hint: (0.2,0.1)
            pos_hint: {'x':0, 'y':0}
            text: 'Close'
            on_release: root.dismiss()

<EntangledScreen>:
    name: 'ES'

    #Qua variables

    n_label: n_label #MOLT IMPORTANT AIXÒ, SI NO EL PROGRAMA NO SAP DE Q ÉS
    label_s1:label_s1
    label_s2:label_s2
    table_checkbox:table_checkbox
    graph_checkbox:graph
    s_label:s_label
    delete_button:delete_button
    select_button:select_button
    clear_btn:clear_btn
    plot_btn:plot_btn
    b1_label:b1_label
    b2_label:b2_label


    #HVT variables

    n_label_hvt : n_label_hvt
    label_s1_hvt : label_s1_hvt
    label_s2_hvt : label_s2_hvt
    table_checkbox_hvt : table_checkbox_hvt
    graph_checkbox_hvt : graph_hvt
    s_label_hvt : s_label_hvt
    delete_button_hvt : delete_button_hvt
    select_button_hvt : select_button_hvt
    clear_btn_hvt : clear_btn_hvt
    plot_btn_hvt : plot_btn_hvt
    b1_label_hvt : b1_label_hvt
    b2_label_hvt : b2_label_hvt
    reps : reps

    BoxLayout:

        orientation: "vertical"
        padding: 10
        spacing: 10
        # Adding image from the system

        BoxLayout:
            orientation: "horizontal"
            Image:
                id: I1
                pos_hint:{'x': 0., 'y':0.}
                source: 'img\pol2.png'

            # Giving the size of image
                size_hint: (0.7,0.7)

                # allow sterching of image
                allow_stretch: True
                canvas.before:
                    PushMatrix:
                    Rotate:
                        angle: 0
                        origin:self.center
                canvas.after:
                    PopMatrix

            animWidg:
                id: anwidg
                canvas.before:
                    Rectangle:
                        source: 'img\sketch_exp_1.png'
                        pos: self.pos[0] , self.pos[1]
                        size: (self.width*0.75, self.height)
                        id: i_rect



        TabbedPanel:
            size_hint: (1, 1)
            do_default_tab: False

            TabbedPanelItem: #creem la primera pestanya
                text: "[b]Quantic\n experiment:[/b]"
                markup: True
                on_release: root.tab_selector = 0

                BoxLayout:
                    orientation: "horizontal" #el partim en 2 cols grans

                    BoxLayout:
                        orientation:"vertical"
                        Label:
                            text: "[b]Experiment settings:[/b]"
                            markup: True
                        BoxLayout:
                            orientation: "horizontal"
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Label:
                                    text: "Number of photons:"
                                    markup: True
                                    pos_hint:{'x': .7, 'y':.3}
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Button:
                                    text:"-"
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': 1.3, 'y':.7}
                                    on_press: root.start_photon_adding(-10000)
                                    on_press: root.add_photons(-10000)
                                    on_release: root.stop_photon_adding()
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Label:
                                    id: n_label
                                    text: "10000"
                                    markup: True
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': 0.7, 'y':.7}
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Button:
                                    text: "+"
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': .2, 'y':.7}
                                    on_press: root.start_photon_adding(10000)
                                    on_press: root.add_photons(10000)
                                    on_release: root.stop_photon_adding()

                        FloatLayout:
                            Label:
                                id: s_label
                                size_hint: None, None
                                size:240,100
                                text:'[font=digital-7][color=000000][size=34] S=                [/color][/font][/size]'
                                markup:True
                                pos_hint:{'x':0.1,'y':0.2}
                                canvas:
                                canvas.before:
                                    Color:
                                        rgba: 0, 153, 0, 0.5

                                    RoundedRectangle:
                                        pos: self.pos[0] , self.pos[1]+20
                                        size: (self.width, self.height*0.8)
                                        id: S_rect

                    BoxLayout:
                        orientation:"vertical"
                        Label:
                            text:"[b]Polarizer angles:[/b]"
                            markup: True
                        Label:
                            text: "angle of polarizer 1: \u03B1 (deg)"
                            pos_hint:{'x': 0, 'y':0}
                        AngleKnob:
                            pos_hint:{'x': 0.3, 'y':.7}
                            min: 0
                            max: 360
                            step: 1
                            slope: 1
                            value: 0
                            on_release: root.runexp()
                            on_release: anwidg.run_animation()
                            knobimg_source: "img/knob_metal.png"
                            show_marker: True  # Show surrounding marker
                            marker_img: "img/bline2.png" # Marker texture image

                            Label:
                                id: label_s1
                                text: "{}".format(int(self.parent.value))
                                center: self.parent.center
                                font_size: 20
                                color: 0.1, 0.1, 0.1, 1

                        Label:
                            text: "angle of polarizer 2: \u03B2 (deg)"
                        AngleKnob:
                            pos_hint:{'x': 0.3, 'y':.7}
                            min: 0
                            max: 360
                            step: 1
                            slope: 1
                            value: 0
                            knobimg_source: "img/knob_metal.png"
                            show_marker: True  # Show surrounding marker
                            on_release: root.runexp()
                            on_release: anwidg.run_animation()
                            marker_img: "img/bline2.png" # Marker texture image

                            Label:
                                id: label_s2
                                text: "{}".format(int(self.parent.value))
                                center: self.parent.center
                                font_size: 20
                                color: 0.1, 0.1, 0.1, 1

                    BoxLayout:
                        orientation:"vertical"
                        BoxLayout:
                            orientation: "vertical"
                            FloatLayout:
                                CheckBox:
                                    id: graph
                                    size_hint:(0.2,0.2)
                                    pos_hint:{'x': 0, 'y':0.4}
                                Label:
                                    text: "Generate 3D S-plot"
                                    pos_hint:{'x': -0.1, 'y':0}
                            BoxLayout:
                                orientation: "horizontal"
                                BoxLayout:
                                    orientation: "vertical"
                                    Button:
                                        id: select_button
                                        text: "Select angle"
                                        disabled: True
                                        on_release:root.select_angle()
                                    Button:
                                        id: delete_button
                                        disabled: True
                                        text: "Delete angle"
                                        on_release:root.delete_angle()
                                BoxLayout:
                                    orientation: "vertical"
                                    BoxLayout:
                                        orientation: "horizontal"
                                        Label:
                                            text:"\u03B2"+"1:"
                                        TextInput:
                                            id: b1_label
                                            size_hint: (1,1.25)
                                            text: ' '
                                            font_name: 'digital-7.ttf'
                                            font_size: 20
                                            multiline:False
                                            on_text:root.kwinput=True
                                            on_text_validate:root.select_angle()
                                            disabled: not graph.active

                                    BoxLayout:
                                        orientation: "horizontal"
                                        Label:
                                            text:"\u03B2"+"2:"
                                        TextInput:
                                            id: b2_label
                                            size_hint: (1,1.25)
                                            text: ' '
                                            font_name: 'digital-7.ttf'
                                            font_size: 20
                                            multiline:False
                                            on_text:root.kwinput=True
                                            on_text_validate:root.select_angle()
                                            disabled: not graph.active

                            BoxLayout:
                                orientation: "horizontal"
                                Button:
                                    id:plot_btn
                                    text: "Plot"
                                    size_hint: (0.9,0.7)
                                    disabled: True
                                    on_release: root.manager.get_screen('GS').get_graph()

                                Button:
                                    id:clear_btn
                                    text: "Clear"
                                    size_hint: (0.9,0.7)
                                    disabled: True
                                    on_release:root.clear_angles()
                        BoxLayout:
                            orientation: "horizontal"
                            FloatLayout:
                                CheckBox:
                                    id: table_checkbox
                                    size_hint:(0.2,0.2)
                                    pos_hint:{'x': 0, 'y':0.4}

                                Label:
                                    text: "Generate table"
                                    pos_hint:{'x': -0.1, 'y':0}

            TabbedPanelItem: #creem la 2a pestanya
                text: "[b]HVT[/b]"
                markup: True
                on_release : root.tab_selector = 1
                BoxLayout:
                    orientation: "horizontal" #el partim en 2 cols grans

                    BoxLayout:
                        orientation:"vertical"
                        Label:
                            text: "[b]Experiment settings:[/b]"
                            markup: True
                        BoxLayout:
                            orientation: "horizontal"
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Label:
                                    text: "Number of photons:"
                                    markup: True
                                    pos_hint:{'x': .7, 'y':.3}
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Button:
                                    text:"-"
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': 1.3, 'y':.7}
                                    on_press:root.start_photon_adding(-1000)
                                    on_press: root.add_photons(-1000)
                                    on_release: root.stop_photon_adding()
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Label:
                                    id: n_label_hvt
                                    text: "1000"
                                    markup: True
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': 0.7, 'y':.7}
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Button:
                                    text: "+"
                                    size_hint: (0.3,0.2)
                                    pos_hint:{'x': .2, 'y':.7}
                                    on_press: root.start_photon_adding(1000)
                                    on_press: root.add_photons(1000)
                                    on_release: root.stop_photon_adding()

                        BoxLayout:
                            orientation: "horizontal"
                            FloatLayout:
                                pos_hint:{'x': 0, 'y':.0}
                                Label:
                                    pos_hint:{'x': 0.1, 'y':.5}
                                    text: "Number of repetitions\n of the experiment:"

                            FloatLayout:
                                TextInput:
                                    id:reps
                                    size_hint: (0.4,.5)
                                    pos_hint : {'x': 0.3, 'y':.7}
                                    multiline : False
                                    text : '1'

                        FloatLayout:
                            Label:
                                id: s_label_hvt
                                size_hint: None, None
                                size:240,100
                                text:'[font=digital-7][color=000000][size=34] S=                [/color][/font][/size]'
                                markup:True
                                pos_hint:{'x':0.2,'y':0.15}
                                canvas:
                                canvas.before:
                                    Color:
                                        rgba: 0, 153, 0, 0.5

                                    RoundedRectangle:
                                        pos: self.pos[0] , self.pos[1]+20
                                        size: (self.width, self.height*0.8)
                                        id: S_rect_hvt

                    BoxLayout:
                        orientation:"vertical"
                        Label:
                            text:"[b]Polarizer angles:[/b]"
                            markup: True
                        Label:
                            text: "angle of polarizer 1: \u03B1 (deg)"
                            pos_hint:{'x': 0, 'y':0}
                        AngleKnob:
                            pos_hint:{'x': 0.3, 'y':.7}
                            min: 0
                            max: 360
                            step: 1
                            slope: 1
                            value: 0
                            #on_release: root.runexp()
                            knobimg_source: "img/knob_metal.png"
                            show_marker: True  # Show surrounding marker
                            marker_img: "img/bline2.png" # Marker texture image

                            Label:
                                id: label_s1_hvt
                                text: "{}".format(int(self.parent.value))
                                center: self.parent.center
                                font_size: 20
                                color: 0.1, 0.1, 0.1, 1

                        Label:
                            text: "angle of polarizer 2: \u03B2 (deg)"
                        AngleKnob:
                            pos_hint:{'x': 0.3, 'y':.7}
                            min: 0
                            max: 360
                            step: 1
                            slope: 1
                            value: 0
                            knobimg_source: "img/knob_metal.png"
                            show_marker: True  # Show surrounding marker
                            #on_release: root.runexp()
                            marker_img: "img/bline2.png" # Marker texture image
                            #on_touch_up: root.runexp()

                            Label:
                                id: label_s2_hvt
                                text: "{}".format(int(self.parent.value))
                                center: self.parent.center
                                font_size: 20
                                color: 0.1, 0.1, 0.1, 1

                    BoxLayout:
                        orientation:"vertical"
                        BoxLayout:
                            orientation: "vertical"
                            FloatLayout:
                                CheckBox:
                                    id: graph_hvt
                                    size_hint:(0.2,0.2)
                                    pos_hint:{'x': 0, 'y':0.4}
                                Label:
                                    text: "Generate 3D S-plot"
                                    pos_hint:{'x': -0.1, 'y':0}
                            BoxLayout:
                                orientation: "horizontal"
                                BoxLayout:
                                    orientation: "vertical"
                                    Button:
                                        id: select_button_hvt
                                        text: "Select angle"
                                        disabled: True
                                        on_release:root.select_angle_hvt()
                                    Button:
                                        id: delete_button_hvt
                                        disabled: True
                                        text: "Delete angle"
                                        on_release:root.delete_angle_hvt()
                                BoxLayout:
                                    orientation: "vertical"
                                    BoxLayout:
                                        orientation: "horizontal"
                                        Label:
                                            text:"\u03B2"+"1:"
                                        TextInput:
                                            id: b1_label_hvt
                                            size_hint: (1,1.25)
                                            text: ' '
                                            font_name: 'digital-7.ttf'
                                            font_size: 20
                                            multiline:False
                                            on_text:root.kwinput=True
                                            on_text_validate:root.select_angle_hvt()
                                            disabled: not graph_hvt.active

                                    BoxLayout:
                                        orientation: "horizontal"
                                        Label:
                                            text:"\u03B2"+"2:"
                                        TextInput:
                                            id: b2_label_hvt
                                            size_hint: (1,1.25)
                                            text: ' '
                                            font_name: 'digital-7.ttf'
                                            font_size: 20
                                            multiline:False
                                            on_text:root.kwinput=True
                                            on_text_validate:root.select_angle_hvt()
                                            disabled: not graph_hvt.active

                            BoxLayout:
                                orientation: "horizontal"
                                Button:
                                    id:plot_btn_hvt
                                    text: "Plot"
                                    size_hint: (0.9,0.7)
                                    disabled: True
                                    on_release: root.manager.get_screen('GS').get_graph()

                                Button:
                                    id:clear_btn_hvt
                                    text: "Clear"
                                    size_hint: (0.9,0.7)
                                    disabled: True
                                    on_release:root.clear_angles()
                        BoxLayout:
                            orientation: "horizontal"
                            FloatLayout:
                                CheckBox:
                                    id: table_checkbox_hvt
                                    size_hint:(0.2,0.2)
                                    pos_hint:{'x': 0, 'y':0.4}

                                Label:
                                    text: "Generate table"
                                    pos_hint:{'x': -0.1, 'y':0}

                        Button:
                            size_hint: (1,0.3)
                            text: "Calculate S"
                            id: run_b
                            on_release: root.runexp()
                            on_release: anwidg.run_animation()

            TabbedPanelItem:
                text: "[b]Experiment\n Sketch[/b]"
                markup: True

<GraphScreen>:
    mainlay:mainlay
    name:'GS'
    BoxLayout:
        orientation: 'vertical'
        id: mainlay


